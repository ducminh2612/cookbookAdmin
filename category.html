<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <title>Quản lí danh mục món ăn</title>
    <style>
        a,
        li,
        ul {
            padding: 0;
            text-decoration: none;
        }
    </style>
</head>

<body>
    <section id="sidebar">
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">Easy Food</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="category.html">
					<i class='bx bx-category'></i>
					<span class="text">Danh mục món ăn</span>
				</a>
			</li>
			<li>
				<a href="food.html">
					<i class='bx bx-cylinder' ></i>
					<span class="text">Món ăn</span>
				</a>
			</li>
			<li>
				<a href="feedback.html">
					<i class='bx bx-comment-dots' ></i>
					<span class="text">Đánh giá</span>
				</a>
			</li>
			<li>
				<a href="request.html">	
					<i class='bx bx-task-x'></i>
					<span class="text">Yêu cầu công thức</span>
				</a>
			</li>
            <li>
                <a href="recipes.html">  
                    <i class='bx bxl-discord-alt'></i>
                    <span class="text">Công thức cộng đồng</span>
                </a>
            </li>
			<li>
				<a href="https://console.firebase.google.com/project/cookbook-4178a/authentication/users">
					<i class='bx bxs-group' ></i>
					<span class="text">Tài khoản</span>
				</a>
			</li>
		</ul>
		<ul class="side-menu">
			<li>
				<a href="#">
					<i class='bx bxs-cog' ></i>
					<span class="text">Cài đặt</span>
				</a>
			</li>
			<li>
                <a href="#" class="logout" id="logout-button">
                    <i class='bx bxs-log-out-circle'></i>
                    <span class="text">Đăng xuất</span>
                </a>
            </li>
		</ul>
	</section>
    <section id="content">
        <!-- NAVBAR -->
        <nav>
            <i class='bx bx-menu'></i>
            <a href="#" class="nav-link">Category</a>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Search...">
                    <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
                </div>
            </form>
            <input type="checkbox" id="switch-mode" hidden>
            <label for="switch-mode" class="switch-mode"></label>
            <a href="#" class="notification">
                <i class='bx bxs-bell'></i>
                <span class="num">1</span>
            </a>
            <a href="#" class="profile">
                <img src="img/people.png">
            </a>
        </nav>
        <main>
            <form id="add-category-form" class="m-auto" style="border:1px solid #004972; padding: 12px;border-radius: 5px;margin-bottom: 10px;">
                <h5 class="text-center text-success">Thêm danh mục</h5>
                <label for="name">Tên danh mục món ăn <span style="color: red;">*</span></label>
                <input type="text" name="name" placeholder="Tên danh mục" class="form-control mb-2" required>
                <label for="name">Đường dẫn hình ảnh danh mục <span style="color: red;">*</span></label>
                <input type="text" name="image" placeholder="URL hình ảnh" class="form-control mb-2" required>
                <button type="submit" class="btn btn-success text-center m-auto">Thêm</button>
            </form>
        
            <form id="edit-category-form" class="m-auto mt-5" style="border:1px solid #004972; padding: 12px;border-radius: 5px;display: none;margin-top: 5px;">
                <h5 class="text-center text-warning mt-4">Sửa danh mục</h5>
                <input type="hidden" id="id">
                <label for="name">Tên danh mục món ăn <span style="color: red;">*</span></label>
                <input type="text" id="name" placeholder="Tên danh mục" class="form-control mb-2" required>
                <label for="name">Đường dẫn hình ảnh danh mục <span style="color: red;">*</span></label>
                <input type="text" id="image" placeholder="URL hình ảnh" class="form-control mb-2" required>
                <button type="submit" class="btn btn-warning">Cập nhật</button>
            </form>


            <h4 class="text-center mt-4">Danh sách danh mục</h4>
            <table id="category-list" class="table table-hover table-bordered text-center">
                <tr>
                    <td>Tên danh mục</td>
                    <td>Hình ảnh</td>
                    <td>Thao tác</td>
                </tr>

            </table>
        </main>
    </section>
    <script src="script.js"></script>
</body>

</html>
<style>
    #add-category-form,
    #edit-category-form {
        width: 40%;
    }

    @media (max-width: 768px) {

        #add-category-form,
        #edit-category-form {
            width: 90%;
        }
    }
</style>
<script>
    document.getElementById('logout-button').addEventListener('click', (e) => {
    e.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết

    Swal.fire({
        title: 'Bạn có chắc chắn?',
        text: "Bạn sẽ được đăng xuất khỏi tài khoản của mình.",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Có, đăng xuất!',
        cancelButtonText: 'Hủy'
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire(
                'Đã đăng xuất!',
                'Bạn đã được đăng xuất.',
                'success'
            ).then(() => {
                // Đóng trang hiện tại
                window.close();
            });
        }
    });
});

</script>
<script type="module">
    import {
        initializeApp
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
        getDatabase,
        ref,
        set,
        get,
        update,
        remove
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    const firebaseConfig = {
    apiKey: "AIzaSyDaskTUPCkY6qx46KH5zJ2gI7wDXfATEWs",
    authDomain: "cookbook-4178a.firebaseapp.com",
    databaseURL: "https://cookbook-4178a-default-rtdb.firebaseio.com",
    projectId: "cookbook-4178a",
    storageBucket: "cookbook-4178a.appspot.com",
    messagingSenderId: "277595686841",
    appId: "1:277595686841:web:01639c409215360e73d868"
  };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);


    document.addEventListener("DOMContentLoaded", function() {
        const addCategoryForm = document.getElementById("add-category-form");
        const editCategoryForm = document.getElementById("edit-category-form");
        const categoryList = document.getElementById("category-list");

        if (!addCategoryForm || !editCategoryForm || !categoryList) {
            console.error("Các phần tử không tồn tại.");
            return;
        }

        function fetchCategories() {
            get(ref(db, 'category')).then((snapshot) => {
                if (snapshot.exists()) {
                    const categories = snapshot.val();
                    categoryList.innerHTML = "";
                    categoryList.innerHTML = `<tr>
                            <td>Tên danh mục</td>
                            <td>Hình ảnh danh mục</td>
                            <td>Thao tác</td>
                        </tr>`;
                    for (const [id, category] of Object.entries(categories)) {
                        categoryList.innerHTML += `
                            <tr>
                                <td>${category.name}</td>
                                <td><img src="${category.image}" alt="Category Image" width="50"></td>
                                <td><button onclick="editCategory('${id}', '${category.name}', '${category.image}')" class="btn btn-warning btn-sm">Sửa</button>
                                    <button onclick="deleteCategory('${id}')" class="btn btn-danger btn-sm">Xóa</button>
                                </td>
                            </tr>
                            `;
                    }
                } else {
                    categoryList.innerHTML = "Không có danh mục nào.";
                }
            }).catch((error) => {
                console.error("Có lỗi khi lấy dữ liệu: ", error);
            });
        }

        // Add category
        addCategoryForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const name = addCategoryForm.name.value;
            const image = addCategoryForm.image.value;
            const newCategoryRef = ref(db, 'category/' + Date.now());
            set(newCategoryRef, {
                name: name,
                image: image
            }).then(() => {
                addCategoryForm.reset();
                fetchCategories();
                Swal.fire('Thành công!', 'Danh mục đã được thêm.', 'success');
            }).catch((error) => {
                console.error("Có lỗi khi thêm danh mục sản phẩm : ", error);
            });
        });

        window.editCategory = function(id, name, image) {
            editCategoryForm.id.value = id;
            editCategoryForm.name.value = name;
            editCategoryForm.image.value = image;
            document.getElementById("edit-category-form").style.display = "block";
        };

        editCategoryForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const id = editCategoryForm.id.value;
            const name = editCategoryForm.name.value;
            const image = editCategoryForm.image.value;
            const categoryRef = ref(db, 'category/' + id);
            update(categoryRef, {
                name: name,
                image: image
            }).then(() => {
                editCategoryForm.reset();
                document.getElementById("edit-category-form").style.display = "none";
                fetchCategories();
                Swal.fire('Thành công!', 'Danh mục đã được cập nhật.', 'success');
            }).catch((error) => {
                console.error("Lỗi khi cập nhật dữ liệu: ", error);
            });
        });

        window.deleteCategory = function(id) {
            Swal.fire({
                title: 'Bạn có chắc không?',
                text: "Danh mục sẽ bị xóa vĩnh viễn!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    const categoryRef = ref(db, 'category/' + id);
                    remove(categoryRef).then(() => {
                        fetchCategories();
                        Swal.fire('Đã xóa!', 'Danh mục đã được xóa.', 'success');
                    }).catch((error) => {
                        console.error("Có lỗi khi xóa danh mục: ", error);
                    });
                }
            });
        };

        fetchCategories();
    });
</script>



<script src="/script.js"></script>
<script src="script.js"></script>